<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <title>–ú–æ—ó –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ</title>
  <style>
   
    
    /* –ö–Ω–æ–ø–∫–∞ –º–µ–Ω—é */
    .menu-icon { 
      position: fixed; 
      top: 20px; 
      left: 20px; 
      width: 30px; 
      cursor: pointer; 
      z-index: 1100;
      transition: transform 0.3s ease;
    }
    .menu-icon div { 
      width: 100%; 
      height: 4px; 
      background: #000; 
      margin: 6px 0; 
      transition: all 0.3s ease;
    }
    
    /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é */
    .menu-open .menu-icon {
      transform: translateX(250px);
    }
    .menu-open .menu-icon div:nth-child(1) {
      transform: rotate(45deg) translate(8px, 8px);
    }
    .menu-open .menu-icon div:nth-child(2) {
      opacity: 0;
    }
    .menu-open .menu-icon div:nth-child(3) {
      transform: rotate(-45deg) translate(8px, -8px);
    }
    
    /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
    .sidebar {
      position: fixed;
      top: 0;
      left: -280px;
      width: 280px;
      height: 100vh;
      background: linear-gradient(135deg, #00796b, #004d40);
      box-shadow: 2px 0 10px rgba(0,0,0,0.3);
      transition: left 0.3s ease;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      padding: 20px;
      box-sizing: border-box;
    }
    
    .sidebar.open {
      left: 0;
    }
    
    .sidebar-header {
      color: white;
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 40px;
      text-align: center;
      padding: 20px 0;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    
    .sidebar-menu {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .sidebar-item {
      padding: 15px 20px;
      color: white;
      text-decoration: none;
      border-radius: 10px;
      transition: background 0.2s ease;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .sidebar-item:hover {
      background: rgba(255,255,255,0.1);
    }
    
    .sidebar-item.logout {
      background: #c62828;
      margin-top: auto;
    }
    
    .sidebar-item.logout:hover {
      background: #b71c1c;
    }
    
    /* Overlay –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.5);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      z-index: 999;
    }
    
    .overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
    .container {
      min-height: 100vh;
      padding: 80px 20px 20px;
      transition: transform 0.3s ease;
      max-width: 800px;
      margin: 0 auto;
    }
    
    /* –°–¥–≤–∏–≥ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–º –º–µ–Ω—é */
    .menu-open .container {
      transform: translateX(280px);
    }
    
    .page-title {
      font-size: 28px;
      font-weight: bold;
      color: #333;
      margin-bottom: 30px;
      text-align: center;
    }
    
    /* –ö–∞—Ä—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º */
    .habit-item { 
      display: flex; 
      flex-direction: column;
      background: #fff; 
      border-radius: 12px; 
      padding: 20px; 
      margin-bottom: 16px; 
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
    }
    
    .habit-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }
    
    .habit-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .habit-name { 
      font-size: 18px;
      font-weight: 600;
      color: #333;
    }

    .edit-btn {
      background: #2196f3;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s ease;
    }

    .edit-btn:hover {
      background: #1976d2;
    }
    
    .habit-days {
      font-size: 14px;
      color: #666;
      background: #f0f0f0;
      padding: 6px 12px;
      border-radius: 16px;
      margin-bottom: 12px;
      display: inline-block;
    }
    
    .progress-container {
      margin-bottom: 12px;
    }
    
    .progress-bar {
      width: 100%;
      height: 10px;
      background: #e0e0e0;
      border-radius: 5px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #00796b, #4caf50);
      border-radius: 5px;
      transition: width 0.3s ease;
    }
    
    .progress-text {
      font-size: 14px;
      color: #666;
      text-align: right;
      margin-top: 6px;
    }
    
    .completion-buttons {
      display: flex;
      gap: 12px;
      margin-top: 16px;
    }
    
    .complete-btn {
      flex: 1;
      padding: 12px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s ease;
    }
    
    .complete-btn.done {
      background: #4caf50;
      color: white;
    }
    
    .complete-btn.skip {
      background: #ff9800;
      color: white;
    }
    
    .complete-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .complete-btn.done:hover {
      background: #45a049;
    }
    
    .complete-btn.skip:hover {
      background: #e68900;
    }

    .complete-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .complete-btn:disabled:hover {
      transform: none;
      box-shadow: none;
    }

    .loading {
      text-align: center;
      color: #666;
      padding: 40px;
      font-size: 16px;
    }

    .empty-state {
      text-align: center;
      color: #666;
      padding: 60px 20px;
      font-size: 16px;
    }

    .empty-state::before {
      content: "üìù";
      display: block;
      font-size: 48px;
      margin-bottom: 16px;
    }
  </style>
</head>
<body>
  <!-- Overlay -->
  <div class="overlay" id="overlay"></div>
  
  <!-- –ö–Ω–æ–ø–∫–∞ –º–µ–Ω—é -->
  <div class="menu-icon" onclick="toggleMenu()">
    <div></div><div></div><div></div>
  </div>

  <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      TrackJoi
    </div>
    <div class="sidebar-menu">
      <div class="sidebar-item">
        üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
      </div>
      <div class="sidebar-item">
        ‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
      </div>
      <div class="sidebar-item">
        üéØ –ú–æ—ó —Ü—ñ–ª—ñ
      </div>
      <div class="sidebar-item logout">
        üö™ –í–∏—Ö—ñ–¥
      </div>
    </div>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
  <div class="container">
    <h1 class="page-title">–ú–æ—ó –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ</h1>
    <div id="activityList" class="loading">
      –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π...
    </div>
  </div>

  <script>
    // –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –±–æ–∫–æ–≤–æ–≥–æ –º–µ–Ω—é
    function toggleMenu() {
      document.body.classList.toggle('menu-open');
      document.querySelector('.sidebar').classList.toggle('open');
      document.querySelector('.overlay').classList.toggle('active');
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π –∑ –±–µ–∫–µ–Ω–¥—É –∞–±–æ localStorage
    async function loadActivities() {
      const token = localStorage.getItem('authToken');
      
      // –°–ø—Ä–æ–±—É—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑ localStorage –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
      const localActivities = JSON.parse(localStorage.getItem('activities') || '[]');
      if (localActivities.length > 0) {
        const formattedActivities = localActivities.map((activity, index) => ({
          id: index,
          name: activity.name,
          progress: Math.round((activity.completedThisWeek || 0) / Math.max(activity.days?.length || 1, 1) * 100),
          days_of_week: activity.days ? activity.days.join(', ') : '–ù–µ –∑–∞–¥–∞–Ω–æ',
          completed_today: false
        }));
        renderActivities(formattedActivities);
        return;
      }

      if (!token) {
        // –Ø–∫—â–æ –Ω–µ–º–∞—î —Ç–æ–∫–µ–Ω–∞ —ñ –Ω–µ–º–∞—î –ª–æ–∫–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö, –ø–æ–∫–∞–∑—É—î–º–æ –¥–µ–º–æ
        renderActivities(getDemoActivities());
        return;
      }

      try {
        const response = await fetch('http://localhost:3000/api/activities', {
          headers: {
            'Authorization': 'Bearer ' + token
          }
        });

        if (!response.ok) throw new Error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π");

        const activities = await response.json();
        renderActivities(activities);
      } catch (err) {
        console.error(err);
        // –ü–æ–∫–∞–∑—É—î–º–æ –¥–µ–º–æ-–¥–∞–Ω—ñ —É –≤–∏–ø–∞–¥–∫—É –ø–æ–º–∏–ª–∫–∏
        renderActivities(getDemoActivities());
      }
    }

    // –î–µ–º–æ-–¥–∞–Ω—ñ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
    function getDemoActivities() {
      return [
        {
          id: 1,
          name: "–†–∞–Ω–∫–æ–≤–∞ –∑–∞—Ä—è–¥–∫–∞",
          progress: 75,
          days_of_week: "–ü–Ω, –í—Ç, –°—Ä, –ß—Ç, –ü—Ç",
          completed_today: false
        },
        {
          id: 2,
          name: "–ß–∏—Ç–∞–Ω–Ω—è –∫–Ω–∏–≥",
          progress: 60,
          days_of_week: "–©–æ–¥–Ω—è",
          completed_today: true
        },
        {
          id: 3,
          name: "–ú–µ–¥–∏—Ç–∞—Ü—ñ—è",
          progress: 40,
          days_of_week: "–ü–Ω, –°—Ä, –ü—Ç",
          completed_today: false
        }
      ];
    }

    // –†–µ–Ω–¥–µ—Ä –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π —É DOM
    function renderActivities(activities) {
      const listContainer = document.getElementById('activityList');
      if (!listContainer) return;

      if (activities.length === 0) {
        listContainer.innerHTML = '<div class="empty-state">–£ –≤–∞—Å –ø–æ–∫–∏ –Ω–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π.<br>–î–æ–¥–∞–π—Ç–µ –Ω–æ–≤—ñ —á–µ—Ä–µ–∑ –º–µ–Ω—é "–ú–æ—ó —Ü—ñ–ª—ñ"</div>';
        return;
      }

      listContainer.innerHTML = '';

      activities.forEach((activity, index) => {
        const item = document.createElement('div');
        item.className = 'habit-item';

        const progressWidth = Math.min(Math.max(activity.progress || 0, 0), 100);
        const isCompleted = activity.completed_today;

        item.innerHTML = `
          <div class="habit-header">
            <div class="habit-name">${activity.name}</div>
            <button class="edit-btn" onclick="editActivity(${index})">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
          </div>
          <div class="habit-days">–ü–æ–≤—Ç–æ—Ä: ${activity.days_of_week}</div>
          <div class="progress-container">
            <div class="progress-bar">
              <div class="progress-fill" style="width: ${progressWidth}%"></div>
            </div>
            <div class="progress-text">${progressWidth}% –≤–∏–∫–æ–Ω–∞–Ω–æ</div>
          </div>
          <div class="completion-buttons">
            <button class="complete-btn done" onclick="completeActivity(${activity.id})" ${isCompleted ? 'disabled' : ''}>
              ${isCompleted ? '‚úÖ –í–∏–∫–æ–Ω–∞–Ω–æ' : '‚úì –í–∏–∫–æ–Ω–∞—Ç–∏'}
            </button>
            <button class="complete-btn skip" onclick="skipActivity(${activity.id})" ${isCompleted ? 'disabled' : ''}>
              ${isCompleted ? '‚è≠Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ' : '‚è≠ –ü—Ä–æ–ø—É—Å—Ç–∏—Ç–∏'}
            </button>
          </div>
        `;

        listContainer.appendChild(item);
      });
    }

    // –§—É–Ω–∫—Ü—ñ—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
    function editActivity(index) {
      // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —ñ–Ω–¥–µ–∫—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
      localStorage.setItem('editIndex', index);
      // –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
      window.location.href = 'edit.html';
    }

    // –§—É–Ω–∫—Ü—ñ—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
    async function completeActivity(activityId) {
      try {
        const token = localStorage.getItem('authToken');
        const response = await fetch(`http://localhost:3000/api/activities/${activityId}/complete`, {
          method: 'POST',
          headers: {
            'Authorization': 'Bearer ' + token,
            'Content-Type': 'application/json'
          }
        });

        if (response.ok) {
          // –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
          loadActivities();
        } else {
          alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—ñ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ');
        }
      } catch (err) {
        console.error(err);
        alert('–ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ');
      }
    }

    // –§—É–Ω–∫—Ü—ñ—è –ø—Ä–æ–ø—É—Å–∫—É –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
    async function skipActivity(activityId) {
      try {
        const token = localStorage.getItem('authToken');
        const response = await fetch(`http://localhost:3000/api/activities/${activityId}/skip`, {
          method: 'POST',
          headers: {
            'Authorization': 'Bearer ' + token,
            'Content-Type': 'application/json'
          }
        });

        if (response.ok) {
          // –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
          loadActivities();
        } else {
          alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –ø—Ä–æ–ø—É—Å–∫—É –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ');
        }
      } catch (err) {
        console.error(err);
        alert('–ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ');
      }
    }

    // –ó–∞–ø—É—Å–∫ –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è DOM
    document.addEventListener('DOMContentLoaded', () => {
      loadActivities();

      // –ó–∞–∫—Ä–∏—Ç—Ç—è –º–µ–Ω—é –ø—Ä–∏ –∫–ª—ñ–∫—É –Ω–∞ overlay
      const overlay = document.querySelector('.overlay');
      if (overlay) {
        overlay.addEventListener('click', toggleMenu);
      }
    });
  </script>
</body>
</html>